machine:
  environment:
    RUST_HOME: $HOME/rust
    PATH: $PATH:$RUST_HOME/bin:~/.cargo/bin
    LD_LIBRARY_PATH: $LD_LIBRARY_PATH:~/rust/lib/

dependencies:
  post:
    - ./scripts/install-rust.sh $RUST_HOME nightly
    - ./scripts/install-clippy.sh
    - ./scripts/install-alsa.sh
    - rustc --version --verbose

  cache_directories:
    - "~/rust"
    - "~/.cargo"

test:
  override:
    - LD_LIBRARY_PATH=~/rust/lib/ cargo clippy
    - ./scripts/install-rust.sh $RUST_HOME default
    - cargo test
